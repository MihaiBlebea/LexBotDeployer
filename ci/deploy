#!/usr/bin/env node


const AWS = require('aws-sdk')
const files = require('./../services/files')
const versions = require('./../services/versions')
const log = require('./../services/logger')
const tester = require('./../services/tester')

const Wilbur = require('./../services/Wilbur')
const SlotManager = require('./../services/SlotManager')
const IntentManager = require('./../services/IntentManager')
const BotManager = require('./../services/BotManager')
const LambdaManger = require('./../services/LambdaManager')


var branch = process.argv[2]

var config = new AWS.Config({
    accessKeyId: 'AKID',
    secretAccessKey: 'SECRET',
    region: 'us-west-1'
})

var lambda = new AWS.Lambda({ region: 'us-east-1', maxRetries: 15 })
var lex = new AWS.LexModelBuildingService({ region: 'us-east-1', maxRetries: 15 })

var slotManager = new SlotManager(lex, versions, log)
var intentManager = new IntentManager(lex, versions, log)
var botManager = new BotManager(lex, versions, log)
var lambdaManager = new LambdaManger(lambda, tester, files)

deployer = new Wilbur(files, versions, slotManager, intentManager, botManager, lambdaManager)
deployer.deploy(()=>{
    console.log('REACH THE END')
    process.exit(0)
})
